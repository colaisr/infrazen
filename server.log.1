2025-10-25 13:39:30,069 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:39:30,074 INFO sqlalchemy.engine.Engine: [cached since 2.141s ago] {'pk_1': 6}
2025-10-25 13:39:30,075 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:39:30,076 INFO sqlalchemy.engine.Engine: [cached since 2.143s ago] {'pk_1': 5}
2025-10-25 13:39:30,078 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.id = %(pk_1)s
2025-10-25 13:39:30,079 INFO sqlalchemy.engine.Engine: [generated in 0.00019s] {'pk_1': 5353}
2025-10-25 13:39:30,080 INFO sqlalchemy.engine.Engine: UPDATE sync_snapshots SET sync_status=%(sync_status)s, sync_completed_at=%(sync_completed_at)s, total_resources_found=%(total_resources_found)s, resources_created=%(resources_created)s, updated_at=%(updated_at)s WHERE sync_snapshots.id = %(sync_snapshots_id)s
2025-10-25 13:39:30,080 INFO sqlalchemy.engine.Engine: [generated in 0.00018s] {'sync_status': 'success', 'sync_completed_at': datetime.datetime(2025, 10, 25, 13, 39, 30, 77326), 'total_resources_found': 4, 'resources_created': 4, 'updated_at': datetime.datetime(2025, 10, 25, 13, 39, 30, 80498), 'sync_snapshots_id': 5353}
2025-10-25 13:39:30,081 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.id = %(pk_1)s
2025-10-25 13:39:30,082 INFO sqlalchemy.engine.Engine: [cached since 0.003227s ago] {'pk_1': 5353}
2025-10-25 13:39:30,084 INFO sqlalchemy.engine.Engine: UPDATE cloud_providers SET last_sync=%(last_sync)s, updated_at=%(updated_at)s WHERE cloud_providers.id = %(cloud_providers_id)s
2025-10-25 13:39:30,085 INFO sqlalchemy.engine.Engine: [generated in 0.00106s] {'last_sync': datetime.datetime(2025, 10, 25, 13, 39, 30, 83042), 'updated_at': datetime.datetime(2025, 10, 25, 13, 39, 30, 83978), 'cloud_providers_id': 2}
2025-10-25 13:39:30,086 INFO sqlalchemy.engine.Engine: UPDATE sync_snapshots SET sync_duration_seconds=%(sync_duration_seconds)s, sync_config=%(sync_config)s, updated_at=%(updated_at)s WHERE sync_snapshots.id = %(sync_snapshots_id)s
2025-10-25 13:39:30,086 INFO sqlalchemy.engine.Engine: [generated in 0.00015s] {'sync_duration_seconds': 38, 'sync_config': '{"sync_method": "billing_first", "openstack_auth_ok": true, "orphan_volumes": 0, "zombie_resources": 0, "unified_vms": 1, "total_daily_cost": 57.6, "zombie_daily_cost": 0, "orphan_daily_cost": 0, "service_types": ["load_balancer", "server", "volume"], "billed_resource_count": 4}', 'updated_at': datetime.datetime(2025, 10, 25, 13, 39, 30, 86172), 'sync_snapshots_id': 5353}
2025-10-25 13:39:30,087 INFO sqlalchemy.engine.Engine: COMMIT
2025-10-25 13:39:30,088 INFO app.providers.selectel.service: Sync completed: 4 resources, 57.60 ₽/day
2025-10-25 13:39:30,088 INFO app.providers.selectel.service:   - Active: 4
2025-10-25 13:39:30,088 INFO app.providers.selectel.service:   - Zombies: 0 (0.00 ₽/day)
2025-10-25 13:39:30,088 INFO app.providers.selectel.service:   - Orphan volumes: 0 (0.00 ₽/day)
2025-10-25 13:39:30,089 INFO sqlalchemy.engine.Engine: BEGIN (implicit)
2025-10-25 13:39:30,089 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_status AS sync_snapshots_sync_status, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_completed_at AS sync_snapshots_sync_completed_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.total_resources_found AS sync_snapshots_total_resources_found, sync_snapshots.resources_created AS sync_snapshots_resources_created, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.id = %(pk_1)s
2025-10-25 13:39:30,089 INFO sqlalchemy.engine.Engine: [cached since 33.2s ago] {'pk_1': 5353}
2025-10-25 13:39:30,090 INFO sqlalchemy.engine.Engine: SELECT cloud_providers.user_id AS cloud_providers_user_id, cloud_providers.provider_type AS cloud_providers_provider_type, cloud_providers.connection_name AS cloud_providers_connection_name, cloud_providers.account_id AS cloud_providers_account_id, cloud_providers.api_endpoint AS cloud_providers_api_endpoint, cloud_providers.credentials AS cloud_providers_credentials, cloud_providers.is_active AS cloud_providers_is_active, cloud_providers.last_sync AS cloud_providers_last_sync, cloud_providers.sync_status AS cloud_providers_sync_status, cloud_providers.sync_error AS cloud_providers_sync_error, cloud_providers.auto_sync AS cloud_providers_auto_sync, cloud_providers.sync_interval AS cloud_providers_sync_interval, cloud_providers.provider_metadata AS cloud_providers_provider_metadata, cloud_providers.id AS cloud_providers_id, cloud_providers.created_at AS cloud_providers_created_at, cloud_providers.updated_at AS cloud_providers_updated_at 
FROM cloud_providers 
WHERE cloud_providers.id = %(pk_1)s
2025-10-25 13:39:30,091 INFO sqlalchemy.engine.Engine: [cached since 29.75s ago] {'pk_1': 2}
2025-10-25 13:39:30,093 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.provider_id = %(provider_id_1)s AND resources.resource_name = %(resource_name_1)s AND resources.resource_type = %(resource_type_1)s 
 LIMIT %(param_1)s
2025-10-25 13:39:30,093 INFO sqlalchemy.engine.Engine: [generated in 0.00017s] {'provider_id_1': 2, 'resource_name_1': 'Tess', 'resource_type_1': 'server', 'param_1': 1}
2025-10-25 13:39:30,095 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE %(param_1)s = resource_tags.resource_id
2025-10-25 13:39:30,095 INFO sqlalchemy.engine.Engine: [generated in 0.00016s] {'param_1': 1286}
2025-10-25 13:39:30,097 INFO sqlalchemy.engine.Engine: ROLLBACK
2025-10-25 13:39:39,514 INFO sqlalchemy.engine.Engine: SELECT DATABASE()
2025-10-25 13:39:39,514 INFO sqlalchemy.engine.Engine: [raw sql] {}
2025-10-25 13:39:39,514 INFO sqlalchemy.engine.Engine: SELECT @@sql_mode
2025-10-25 13:39:39,514 INFO sqlalchemy.engine.Engine: [raw sql] {}
2025-10-25 13:39:39,515 INFO sqlalchemy.engine.Engine: SELECT @@lower_case_table_names
2025-10-25 13:39:39,515 INFO sqlalchemy.engine.Engine: [raw sql] {}
2025-10-25 13:39:39,515 INFO sqlalchemy.engine.Engine: BEGIN (implicit)
2025-10-25 13:39:39,516 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.resource_name = %(resource_name_1)s AND resources.resource_type = %(resource_type_1)s 
 LIMIT %(param_1)s
2025-10-25 13:39:39,516 INFO sqlalchemy.engine.Engine: [generated in 0.00007s] {'resource_name_1': 'Tess', 'resource_type_1': 'server', 'param_1': 1}
2025-10-25 13:39:39,518 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE %(param_1)s = resource_tags.resource_id
2025-10-25 13:39:39,518 INFO sqlalchemy.engine.Engine: [generated in 0.00006s] {'param_1': 1286}
2025-10-25 13:39:39,519 INFO sqlalchemy.engine.Engine: ROLLBACK
2025-10-25 13:39:49,946 INFO sqlalchemy.engine.Engine: SELECT DATABASE()
2025-10-25 13:39:49,946 INFO sqlalchemy.engine.Engine: [raw sql] {}
2025-10-25 13:39:49,947 INFO sqlalchemy.engine.Engine: SELECT @@sql_mode
2025-10-25 13:39:49,947 INFO sqlalchemy.engine.Engine: [raw sql] {}
2025-10-25 13:39:49,947 INFO sqlalchemy.engine.Engine: SELECT @@lower_case_table_names
2025-10-25 13:39:49,947 INFO sqlalchemy.engine.Engine: [raw sql] {}
2025-10-25 13:39:49,948 INFO sqlalchemy.engine.Engine: BEGIN (implicit)
2025-10-25 13:39:49,948 INFO sqlalchemy.engine.Engine: SELECT cloud_providers.user_id AS cloud_providers_user_id, cloud_providers.provider_type AS cloud_providers_provider_type, cloud_providers.connection_name AS cloud_providers_connection_name, cloud_providers.account_id AS cloud_providers_account_id, cloud_providers.api_endpoint AS cloud_providers_api_endpoint, cloud_providers.credentials AS cloud_providers_credentials, cloud_providers.is_active AS cloud_providers_is_active, cloud_providers.last_sync AS cloud_providers_last_sync, cloud_providers.sync_status AS cloud_providers_sync_status, cloud_providers.sync_error AS cloud_providers_sync_error, cloud_providers.auto_sync AS cloud_providers_auto_sync, cloud_providers.sync_interval AS cloud_providers_sync_interval, cloud_providers.provider_metadata AS cloud_providers_provider_metadata, cloud_providers.id AS cloud_providers_id, cloud_providers.created_at AS cloud_providers_created_at, cloud_providers.updated_at AS cloud_providers_updated_at 
FROM cloud_providers 
WHERE cloud_providers.provider_type = %(provider_type_1)s AND cloud_providers.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
2025-10-25 13:39:49,949 INFO sqlalchemy.engine.Engine: [generated in 0.00008s] {'provider_type_1': 'selectel', 'user_id_1': 2, 'param_1': 1}
2025-10-25 13:39:49,950 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_status AS sync_snapshots_sync_status, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_completed_at AS sync_snapshots_sync_completed_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.total_resources_found AS sync_snapshots_total_resources_found, sync_snapshots.resources_created AS sync_snapshots_resources_created, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.provider_id = %(provider_id_1)s ORDER BY sync_snapshots.sync_completed_at DESC 
 LIMIT %(param_1)s
2025-10-25 13:39:49,950 INFO sqlalchemy.engine.Engine: [generated in 0.00006s] {'provider_id_1': 2, 'param_1': 1}
2025-10-25 13:39:49,951 INFO sqlalchemy.engine.Engine: ROLLBACK
2025-10-25 13:39:59,544 INFO sqlalchemy.engine.Engine: SELECT DATABASE()
2025-10-25 13:39:59,544 INFO sqlalchemy.engine.Engine: [raw sql] {}
2025-10-25 13:39:59,544 INFO sqlalchemy.engine.Engine: SELECT @@sql_mode
2025-10-25 13:39:59,544 INFO sqlalchemy.engine.Engine: [raw sql] {}
2025-10-25 13:39:59,545 INFO sqlalchemy.engine.Engine: SELECT @@lower_case_table_names
2025-10-25 13:39:59,545 INFO sqlalchemy.engine.Engine: [raw sql] {}
2025-10-25 13:39:59,545 INFO sqlalchemy.engine.Engine: BEGIN (implicit)
2025-10-25 13:39:59,546 INFO sqlalchemy.engine.Engine: SELECT cloud_providers.user_id AS cloud_providers_user_id, cloud_providers.provider_type AS cloud_providers_provider_type, cloud_providers.connection_name AS cloud_providers_connection_name, cloud_providers.account_id AS cloud_providers_account_id, cloud_providers.api_endpoint AS cloud_providers_api_endpoint, cloud_providers.credentials AS cloud_providers_credentials, cloud_providers.is_active AS cloud_providers_is_active, cloud_providers.last_sync AS cloud_providers_last_sync, cloud_providers.sync_status AS cloud_providers_sync_status, cloud_providers.sync_error AS cloud_providers_sync_error, cloud_providers.auto_sync AS cloud_providers_auto_sync, cloud_providers.sync_interval AS cloud_providers_sync_interval, cloud_providers.provider_metadata AS cloud_providers_provider_metadata, cloud_providers.id AS cloud_providers_id, cloud_providers.created_at AS cloud_providers_created_at, cloud_providers.updated_at AS cloud_providers_updated_at 
FROM cloud_providers 
WHERE cloud_providers.provider_type = %(provider_type_1)s AND cloud_providers.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
2025-10-25 13:39:59,546 INFO sqlalchemy.engine.Engine: [generated in 0.00008s] {'provider_type_1': 'selectel', 'user_id_1': 2, 'param_1': 1}
2025-10-25 13:39:59,548 INFO sqlalchemy.engine.Engine: INSERT INTO sync_snapshots (provider_id, sync_type, sync_status, sync_started_at, sync_completed_at, sync_duration_seconds, total_resources_found, resources_created, resources_updated, resources_deleted, resources_unchanged, total_monthly_cost, total_resources_by_type, total_resources_by_status, error_message, error_details, sync_config, created_at, updated_at) VALUES (%(provider_id)s, %(sync_type)s, %(sync_status)s, %(sync_started_at)s, %(sync_completed_at)s, %(sync_duration_seconds)s, %(total_resources_found)s, %(resources_created)s, %(resources_updated)s, %(resources_deleted)s, %(resources_unchanged)s, %(total_monthly_cost)s, %(total_resources_by_type)s, %(total_resources_by_status)s, %(error_message)s, %(error_details)s, %(sync_config)s, %(created_at)s, %(updated_at)s)
2025-10-25 13:39:59,548 INFO sqlalchemy.engine.Engine: [generated in 0.00009s] {'provider_id': 2, 'sync_type': 'billing_first', 'sync_status': 'running', 'sync_started_at': datetime.datetime(2025, 10, 25, 13, 39, 59, 547710), 'sync_completed_at': None, 'sync_duration_seconds': None, 'total_resources_found': 0, 'resources_created': 0, 'resources_updated': 0, 'resources_deleted': 0, 'resources_unchanged': 0, 'total_monthly_cost': 0.0, 'total_resources_by_type': None, 'total_resources_by_status': None, 'error_message': None, 'error_details': None, 'sync_config': None, 'created_at': datetime.datetime(2025, 10, 25, 13, 39, 59, 548345), 'updated_at': datetime.datetime(2025, 10, 25, 13, 39, 59, 548346)}
2025-10-25 13:39:59,550 INFO sqlalchemy.engine.Engine: COMMIT
2025-10-25 13:39:59,551 INFO app.providers.selectel.service: PHASE 0: Validating OpenStack authentication
2025-10-25 13:40:01,392 INFO app.providers.selectel.client: Discovered region: ru-6 -> https://ru-6.cloud.api.selcloud.ru
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: ru-1 -> https://ru-1.cloud.api.selcloud.ru
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: ru-9 -> https://ru-9.cloud.api.selcloud.ru
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: uz-2 -> https://uz-2.cloud.api.servercore.com
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: ke-1 -> https://ke-1.cloud.api.servercore.com
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: ru-8 -> https://ru-8.cloud.api.selcloud.ru
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: gis-2 -> https://gis-2.cloud.api.selcloud.ru
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: kz-1 -> https://kz-1.cloud.api.servercore.com
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: ru-2 -> https://ru-2.cloud.api.selcloud.ru
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: ru-7 -> https://ru-7.cloud.api.selcloud.ru
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: gis-1 -> https://gis-1.cloud.api.selcloud.ru
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: uz-1 -> https://uz-1.cloud.api.servercore.com
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: ru-3 -> https://ru-3.cloud.api.selcloud.ru
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: ru-7 -> https://ru-7.cloud.api.selcloud.ru
2025-10-25 13:40:01,393 INFO app.providers.selectel.client: Discovered region: uz-1 -> https://uz-1.cloud.api.servercore.com
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: kz-1 -> https://kz-1.cloud.api.servercore.com
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: ru-9 -> https://ru-9.cloud.api.selcloud.ru
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: uz-2 -> https://uz-2.cloud.api.servercore.com
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: ke-1 -> https://ke-1.cloud.api.servercore.com
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: gis-1 -> https://gis-1.cloud.api.selcloud.ru
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: ru-2 -> https://ru-2.cloud.api.selcloud.ru
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: ru-8 -> https://ru-8.cloud.api.selcloud.ru
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: ru-6 -> https://ru-6.cloud.api.selcloud.ru
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: ru-1 -> https://ru-1.cloud.api.selcloud.ru
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: ru-3 -> https://ru-3.cloud.api.selcloud.ru
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: gis-2 -> https://gis-2.cloud.api.selcloud.ru
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: uz-1 -> https://uz-1.cloud.api.servercore.com
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: gis-2 -> https://gis-2.cloud.api.selcloud.ru
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: ru-7 -> https://ru-7.cloud.api.selcloud.ru
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: kz-1 -> https://kz-1.cloud.api.servercore.com
2025-10-25 13:40:01,394 INFO app.providers.selectel.client: Discovered region: uz-2 -> https://uz-2.cloud.api.servercore.com
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Discovered region: ru-6 -> https://ru-6.cloud.api.selcloud.ru
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Discovered region: ru-9 -> https://ru-9.cloud.api.selcloud.ru
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Discovered region: ke-1 -> https://ke-1.cloud.api.servercore.com
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Discovered region: ru-3 -> https://ru-3.cloud.api.selcloud.ru
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Discovered region: ru-2 -> https://ru-2.cloud.api.selcloud.ru
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Discovered region: ru-1 -> https://ru-1.cloud.api.selcloud.ru
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Discovered region: gis-1 -> https://gis-1.cloud.api.selcloud.ru
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Discovered region: ru-8 -> https://ru-8.cloud.api.selcloud.ru
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Discovered region: ru-5 -> https://ru-5.cloud.api.selcloud.ru
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Discovered region: ru-4 -> https://ru-4.cloud.api.selcloud.ru
2025-10-25 13:40:01,395 INFO app.providers.selectel.client: Total regions available: 15
2025-10-25 13:40:01,397 INFO app.providers.selectel.service: ✅ OpenStack authentication successful
2025-10-25 13:40:01,397 INFO app.providers.selectel.service: PHASE 1: Fetching billing data (2h window - current active resources only)
2025-10-25 13:40:03,316 INFO app.providers.selectel.service: Caching provision dates for all resources
2025-10-25 13:40:05,873 INFO app.providers.selectel.service: Cached provision dates for 5 resources
2025-10-25 13:40:05,875 INFO app.providers.selectel.service: Found 4 billed resources
2025-10-25 13:40:05,876 INFO app.providers.selectel.service: PHASE 2: Grouping resources by service type
2025-10-25 13:40:05,878 INFO sqlalchemy.engine.Engine: BEGIN (implicit)
2025-10-25 13:40:05,881 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_status AS sync_snapshots_sync_status, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_completed_at AS sync_snapshots_sync_completed_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.total_resources_found AS sync_snapshots_total_resources_found, sync_snapshots.resources_created AS sync_snapshots_resources_created, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.id = %(pk_1)s
2025-10-25 13:40:05,881 INFO sqlalchemy.engine.Engine: [generated in 0.00046s] {'pk_1': 5354}
2025-10-25 13:40:05,884 INFO app.providers.selectel.service: Grouped into 3 service types: ['load_balancer', 'server', 'volume']
2025-10-25 13:40:05,884 INFO app.providers.selectel.service: PHASE 3: Processing servers
2025-10-25 13:40:07,446 INFO app.providers.selectel.client: Found 1 servers in region ru-3 for project 48643015916742d080f0ecdd519bada3
2025-10-25 13:40:07,449 INFO app.providers.selectel.service: ✅ Found server 0264e6f6-b624-4f6f-a605-7db0ca0553d9 using billing-provided location
2025-10-25 13:40:09,368 INFO sqlalchemy.engine.Engine: SELECT cloud_providers.user_id AS cloud_providers_user_id, cloud_providers.provider_type AS cloud_providers_provider_type, cloud_providers.connection_name AS cloud_providers_connection_name, cloud_providers.account_id AS cloud_providers_account_id, cloud_providers.api_endpoint AS cloud_providers_api_endpoint, cloud_providers.credentials AS cloud_providers_credentials, cloud_providers.is_active AS cloud_providers_is_active, cloud_providers.last_sync AS cloud_providers_last_sync, cloud_providers.sync_status AS cloud_providers_sync_status, cloud_providers.sync_error AS cloud_providers_sync_error, cloud_providers.auto_sync AS cloud_providers_auto_sync, cloud_providers.sync_interval AS cloud_providers_sync_interval, cloud_providers.provider_metadata AS cloud_providers_provider_metadata, cloud_providers.id AS cloud_providers_id, cloud_providers.created_at AS cloud_providers_created_at, cloud_providers.updated_at AS cloud_providers_updated_at 
FROM cloud_providers 
WHERE cloud_providers.id = %(pk_1)s
2025-10-25 13:40:09,368 INFO sqlalchemy.engine.Engine: [generated in 0.00062s] {'pk_1': 2}
2025-10-25 13:40:09,374 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.provider_id = %(provider_id_1)s AND resources.resource_id = %(resource_id_1)s
2025-10-25 13:40:09,374 INFO sqlalchemy.engine.Engine: [generated in 0.00040s] {'provider_id_1': 2, 'resource_id_1': '0264e6f6-b624-4f6f-a605-7db0ca0553d9'}
2025-10-25 13:40:09,379 INFO sqlalchemy.engine.Engine: UPDATE resources SET last_sync=%(last_sync)s, updated_at=%(updated_at)s WHERE resources.id = %(resources_id)s
2025-10-25 13:40:09,379 INFO sqlalchemy.engine.Engine: [generated in 0.00033s] {'last_sync': datetime.datetime(2025, 10, 25, 13, 40, 9, 376684), 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 9, 379367), 'resources_id': 1286}
2025-10-25 13:40:09,382 INFO sqlalchemy.engine.Engine: INSERT INTO resource_states (sync_snapshot_id, resource_id, provider_resource_id, resource_type, resource_name, state_action, previous_state, current_state, changes_detected, service_name, region, status, effective_cost, has_cost_change, has_status_change, has_config_change, created_at, updated_at) VALUES (%(sync_snapshot_id)s, %(resource_id)s, %(provider_resource_id)s, %(resource_type)s, %(resource_name)s, %(state_action)s, %(previous_state)s, %(current_state)s, %(changes_detected)s, %(service_name)s, %(region)s, %(status)s, %(effective_cost)s, %(has_cost_change)s, %(has_status_change)s, %(has_config_change)s, %(created_at)s, %(updated_at)s)
2025-10-25 13:40:09,382 INFO sqlalchemy.engine.Engine: [generated in 0.00034s] {'sync_snapshot_id': 5354, 'resource_id': 1286, 'provider_resource_id': '0264e6f6-b624-4f6f-a605-7db0ca0553d9', 'resource_type': 'server', 'resource_name': 'Tess', 'state_action': 'updated', 'previous_state': '{"id": 1286, "provider_id": 2, "resource_id": "0264e6f6-b624-4f6f-a605-7db0ca0553d9", "resource_name": "Tess", "region": "ru-3", "external_ip": null, ... (3149 characters truncated) ... dresses": [], "attached_volumes": [], "created_at": "2025-10-24T13:00:00"}, "created_at": "2025-10-25T10:05:20", "updated_at": "2025-10-25T13:39:00"}', 'current_state': '{"resource_id": "0264e6f6-b624-4f6f-a605-7db0ca0553d9", "resource_name": "Tess", "resource_type": "server", "service_name": "Compute", "region": "ru- ... (2797 characters truncated) ... us": 1, "ram_mb": 1024, "total_storage_gb": 0, "ip_addresses": [], "attached_volumes": [], "created_at": "2025-10-24T13:00:00"}, "external_ip": null}', 'changes_detected': '{"effective_cost": {"previous": 10.32, "current": 0.0}}', 'service_name': 'Compute', 'region': 'ru-3', 'status': 'RUNNING', 'effective_cost': 0.0, 'has_cost_change': 1, 'has_status_change': 0, 'has_config_change': 0, 'created_at': datetime.datetime(2025, 10, 25, 13, 40, 9, 382064), 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 9, 382068)}
2025-10-25 13:40:09,385 INFO sqlalchemy.engine.Engine: COMMIT
2025-10-25 13:40:09,387 INFO sqlalchemy.engine.Engine: BEGIN (implicit)
2025-10-25 13:40:09,389 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.billing_period AS resources_billing_period, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:09,389 INFO sqlalchemy.engine.Engine: [generated in 0.00027s] {'pk_1': 1286}
2025-10-25 13:40:09,391 INFO sqlalchemy.engine.Engine: UPDATE resources SET effective_cost=%(effective_cost)s, currency=%(currency)s, daily_cost=%(daily_cost)s, original_cost=%(original_cost)s, updated_at=%(updated_at)s WHERE resources.id = %(resources_id)s
2025-10-25 13:40:09,391 INFO sqlalchemy.engine.Engine: [generated in 0.00024s] {'effective_cost': 10.32, 'currency': 'RUB', 'daily_cost': 10.32, 'original_cost': 309.6, 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 9, 391254), 'resources_id': 1286}
2025-10-25 13:40:09,392 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.billing_period AS resources_billing_period, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:09,392 INFO sqlalchemy.engine.Engine: [cached since 0.003271s ago] {'pk_1': 1286}
2025-10-25 13:40:09,394 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:09,394 INFO sqlalchemy.engine.Engine: [generated in 0.00022s] {'resource_id_1': 1286, 'tag_key_1': 'monthly_cost_rubles', 'param_1': 1}
2025-10-25 13:40:09,396 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:09,396 INFO sqlalchemy.engine.Engine: [cached since 0.001929s ago] {'resource_id_1': 1286, 'tag_key_1': 'cost_source', 'param_1': 1}
2025-10-25 13:40:09,397 INFO app.providers.selectel.service: Processed 1 VMs (0 zombies)
2025-10-25 13:40:09,397 INFO app.providers.selectel.service: PHASE 3.5: Extracting orphaned volumes from deleted VMs
2025-10-25 13:40:09,397 INFO app.providers.selectel.service: Extracted 0 orphaned volumes from deleted VMs
2025-10-25 13:40:09,397 INFO app.providers.selectel.service: PHASE 4: Processing volumes
2025-10-25 13:40:09,398 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_status AS sync_snapshots_sync_status, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_completed_at AS sync_snapshots_sync_completed_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.total_resources_found AS sync_snapshots_total_resources_found, sync_snapshots.resources_created AS sync_snapshots_resources_created, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.id = %(pk_1)s
2025-10-25 13:40:09,398 INFO sqlalchemy.engine.Engine: [cached since 3.517s ago] {'pk_1': 5354}
2025-10-25 13:40:09,870 WARNING app.providers.selectel.service: Volume 60d3239e-2736-4c6c-9d2f-facef8b02dc4 not found at billing location: Failed to get OpenStack volumes from ru-3: 400 Client Error: Bad Request for url: https://ru-3.cloud.api.selcloud.ru/volume/v3/ae452e6f559f4aeca2c4412dcbbfb60b/volumes/detail
2025-10-25 13:40:24,823 WARNING app.providers.selectel.service: Volume 60d3239e-2736-4c6c-9d2f-facef8b02dc4 not found in any project/region combination
2025-10-25 13:40:24,824 WARNING app.providers.selectel.service: Volume not enriched from OpenStack: 60d3239e-2736-4c6c-9d2f-facef8b02dc4 (disk-for-Esther-#1)
2025-10-25 13:40:27,384 INFO app.providers.selectel.service: Found volume details for 60d3239e-2736-4c6c-9d2f-facef8b02dc4: 5 GB, created: 2025-10-24T13:00:00
2025-10-25 13:40:27,387 INFO sqlalchemy.engine.Engine: SELECT cloud_providers.user_id AS cloud_providers_user_id, cloud_providers.provider_type AS cloud_providers_provider_type, cloud_providers.connection_name AS cloud_providers_connection_name, cloud_providers.account_id AS cloud_providers_account_id, cloud_providers.api_endpoint AS cloud_providers_api_endpoint, cloud_providers.credentials AS cloud_providers_credentials, cloud_providers.is_active AS cloud_providers_is_active, cloud_providers.last_sync AS cloud_providers_last_sync, cloud_providers.sync_status AS cloud_providers_sync_status, cloud_providers.sync_error AS cloud_providers_sync_error, cloud_providers.auto_sync AS cloud_providers_auto_sync, cloud_providers.sync_interval AS cloud_providers_sync_interval, cloud_providers.provider_metadata AS cloud_providers_provider_metadata, cloud_providers.id AS cloud_providers_id, cloud_providers.created_at AS cloud_providers_created_at, cloud_providers.updated_at AS cloud_providers_updated_at 
FROM cloud_providers 
WHERE cloud_providers.id = %(pk_1)s
2025-10-25 13:40:27,388 INFO sqlalchemy.engine.Engine: [cached since 18.02s ago] {'pk_1': 2}
2025-10-25 13:40:27,390 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.provider_id = %(provider_id_1)s AND resources.resource_id = %(resource_id_1)s
2025-10-25 13:40:27,390 INFO sqlalchemy.engine.Engine: [cached since 18.02s ago] {'provider_id_1': 2, 'resource_id_1': '60d3239e-2736-4c6c-9d2f-facef8b02dc4'}
2025-10-25 13:40:27,393 INFO sqlalchemy.engine.Engine: UPDATE resources SET last_sync=%(last_sync)s, updated_at=%(updated_at)s WHERE resources.id = %(resources_id)s
2025-10-25 13:40:27,393 INFO sqlalchemy.engine.Engine: [cached since 18.01s ago] {'last_sync': datetime.datetime(2025, 10, 25, 13, 40, 27, 392398), 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 27, 393402), 'resources_id': 6}
2025-10-25 13:40:27,394 INFO sqlalchemy.engine.Engine: INSERT INTO resource_states (sync_snapshot_id, resource_id, provider_resource_id, resource_type, resource_name, state_action, previous_state, current_state, changes_detected, service_name, region, status, effective_cost, has_cost_change, has_status_change, has_config_change, created_at, updated_at) VALUES (%(sync_snapshot_id)s, %(resource_id)s, %(provider_resource_id)s, %(resource_type)s, %(resource_name)s, %(state_action)s, %(previous_state)s, %(current_state)s, %(changes_detected)s, %(service_name)s, %(region)s, %(status)s, %(effective_cost)s, %(has_cost_change)s, %(has_status_change)s, %(has_config_change)s, %(created_at)s, %(updated_at)s)
2025-10-25 13:40:27,394 INFO sqlalchemy.engine.Engine: [cached since 18.01s ago] {'sync_snapshot_id': 5354, 'resource_id': 6, 'provider_resource_id': '60d3239e-2736-4c6c-9d2f-facef8b02dc4', 'resource_type': 'volume', 'resource_name': 'disk-for-Esther-#1', 'state_action': 'updated', 'previous_state': '{"id": 6, "provider_id": 2, "resource_id": "60d3239e-2736-4c6c-9d2f-facef8b02dc4", "resource_name": "disk-for-Esther-#1", "region": "ru-3", "external ... (857 characters truncated) ... id": "ae452e6f559f4aeca2c4412dcbbfb60b", "project_name": "second project"}, "created_at": "2025-10-14T07:35:57", "updated_at": "2025-10-25T13:39:16"}', 'current_state': '{"resource_id": "60d3239e-2736-4c6c-9d2f-facef8b02dc4", "resource_name": "disk-for-Esther-#1", "resource_type": "volume", "service_name": "Block Stor ... (509 characters truncated) ... b": 5, "created_at": "2025-10-24T13:00:00", "project_id": "ae452e6f559f4aeca2c4412dcbbfb60b", "project_name": "second project"}, "external_ip": null}', 'changes_detected': '{"effective_cost": {"previous": 3.12, "current": 0.0}}', 'service_name': 'Block Storage', 'region': 'ru-3', 'status': 'RUNNING', 'effective_cost': 0.0, 'has_cost_change': 1, 'has_status_change': 0, 'has_config_change': 0, 'created_at': datetime.datetime(2025, 10, 25, 13, 40, 27, 394595), 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 27, 394598)}
2025-10-25 13:40:27,396 INFO sqlalchemy.engine.Engine: COMMIT
2025-10-25 13:40:27,399 INFO sqlalchemy.engine.Engine: BEGIN (implicit)
2025-10-25 13:40:27,400 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.billing_period AS resources_billing_period, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:27,400 INFO sqlalchemy.engine.Engine: [generated in 0.00025s] {'pk_1': 6}
2025-10-25 13:40:27,402 INFO sqlalchemy.engine.Engine: UPDATE resources SET status=%(status)s, effective_cost=%(effective_cost)s, currency=%(currency)s, daily_cost=%(daily_cost)s, original_cost=%(original_cost)s, updated_at=%(updated_at)s WHERE resources.id = %(resources_id)s
2025-10-25 13:40:27,403 INFO sqlalchemy.engine.Engine: [generated in 0.00024s] {'status': 'RUNNING', 'effective_cost': 3.12, 'currency': 'RUB', 'daily_cost': 3.12, 'original_cost': 93.6, 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 27, 402888), 'resources_id': 6}
2025-10-25 13:40:27,404 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.billing_period AS resources_billing_period, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:27,404 INFO sqlalchemy.engine.Engine: [cached since 0.003426s ago] {'pk_1': 6}
2025-10-25 13:40:27,405 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:27,405 INFO sqlalchemy.engine.Engine: [cached since 18.01s ago] {'resource_id_1': 6, 'tag_key_1': 'cost_source', 'param_1': 1}
2025-10-25 13:40:27,406 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:27,406 INFO sqlalchemy.engine.Engine: [cached since 18.01s ago] {'resource_id_1': 6, 'tag_key_1': 'note', 'param_1': 1}
2025-10-25 13:40:27,407 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_status AS sync_snapshots_sync_status, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_completed_at AS sync_snapshots_sync_completed_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.total_resources_found AS sync_snapshots_total_resources_found, sync_snapshots.resources_created AS sync_snapshots_resources_created, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.id = %(pk_1)s
2025-10-25 13:40:27,407 INFO sqlalchemy.engine.Engine: [cached since 21.53s ago] {'pk_1': 5354}
2025-10-25 13:40:27,601 WARNING app.providers.selectel.service: Volume d42402b5-7f73-4a85-9b7d-2fb48a599fc6 not found at billing location: Failed to get OpenStack volumes from ru-8: 400 Client Error: Bad Request for url: https://ru-8.cloud.api.selcloud.ru/volume/v3/ae452e6f559f4aeca2c4412dcbbfb60b/volumes/detail
2025-10-25 13:40:37,136 WARNING app.providers.selectel.service: Volume d42402b5-7f73-4a85-9b7d-2fb48a599fc6 not found in any project/region combination
2025-10-25 13:40:37,138 WARNING app.providers.selectel.service: Volume not enriched from OpenStack: d42402b5-7f73-4a85-9b7d-2fb48a599fc6 (disk-for-Rhiannon-#1)
2025-10-25 13:40:39,364 INFO app.providers.selectel.service: Found volume details for d42402b5-7f73-4a85-9b7d-2fb48a599fc6: 5 GB, created: 2025-10-24T13:00:00
2025-10-25 13:40:39,367 INFO sqlalchemy.engine.Engine: SELECT cloud_providers.user_id AS cloud_providers_user_id, cloud_providers.provider_type AS cloud_providers_provider_type, cloud_providers.connection_name AS cloud_providers_connection_name, cloud_providers.account_id AS cloud_providers_account_id, cloud_providers.api_endpoint AS cloud_providers_api_endpoint, cloud_providers.credentials AS cloud_providers_credentials, cloud_providers.is_active AS cloud_providers_is_active, cloud_providers.last_sync AS cloud_providers_last_sync, cloud_providers.sync_status AS cloud_providers_sync_status, cloud_providers.sync_error AS cloud_providers_sync_error, cloud_providers.auto_sync AS cloud_providers_auto_sync, cloud_providers.sync_interval AS cloud_providers_sync_interval, cloud_providers.provider_metadata AS cloud_providers_provider_metadata, cloud_providers.id AS cloud_providers_id, cloud_providers.created_at AS cloud_providers_created_at, cloud_providers.updated_at AS cloud_providers_updated_at 
FROM cloud_providers 
WHERE cloud_providers.id = %(pk_1)s
2025-10-25 13:40:39,367 INFO sqlalchemy.engine.Engine: [cached since 30s ago] {'pk_1': 2}
2025-10-25 13:40:39,370 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.provider_id = %(provider_id_1)s AND resources.resource_id = %(resource_id_1)s
2025-10-25 13:40:39,370 INFO sqlalchemy.engine.Engine: [cached since 30s ago] {'provider_id_1': 2, 'resource_id_1': 'd42402b5-7f73-4a85-9b7d-2fb48a599fc6'}
2025-10-25 13:40:39,373 INFO sqlalchemy.engine.Engine: UPDATE resources SET last_sync=%(last_sync)s, updated_at=%(updated_at)s WHERE resources.id = %(resources_id)s
2025-10-25 13:40:39,373 INFO sqlalchemy.engine.Engine: [cached since 29.99s ago] {'last_sync': datetime.datetime(2025, 10, 25, 13, 40, 39, 372452), 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 39, 373572), 'resources_id': 5}
2025-10-25 13:40:39,375 INFO sqlalchemy.engine.Engine: INSERT INTO resource_states (sync_snapshot_id, resource_id, provider_resource_id, resource_type, resource_name, state_action, previous_state, current_state, changes_detected, service_name, region, status, effective_cost, has_cost_change, has_status_change, has_config_change, created_at, updated_at) VALUES (%(sync_snapshot_id)s, %(resource_id)s, %(provider_resource_id)s, %(resource_type)s, %(resource_name)s, %(state_action)s, %(previous_state)s, %(current_state)s, %(changes_detected)s, %(service_name)s, %(region)s, %(status)s, %(effective_cost)s, %(has_cost_change)s, %(has_status_change)s, %(has_config_change)s, %(created_at)s, %(updated_at)s)
2025-10-25 13:40:39,375 INFO sqlalchemy.engine.Engine: [cached since 29.99s ago] {'sync_snapshot_id': 5354, 'resource_id': 5, 'provider_resource_id': 'd42402b5-7f73-4a85-9b7d-2fb48a599fc6', 'resource_type': 'volume', 'resource_name': 'disk-for-Rhiannon-#1', 'state_action': 'updated', 'previous_state': '{"id": 5, "provider_id": 2, "resource_id": "d42402b5-7f73-4a85-9b7d-2fb48a599fc6", "resource_name": "disk-for-Rhiannon-#1", "region": "ru-8", "extern ... (861 characters truncated) ... id": "ae452e6f559f4aeca2c4412dcbbfb60b", "project_name": "second project"}, "created_at": "2025-10-14T07:35:48", "updated_at": "2025-10-25T13:39:28"}', 'current_state': '{"resource_id": "d42402b5-7f73-4a85-9b7d-2fb48a599fc6", "resource_name": "disk-for-Rhiannon-#1", "resource_type": "volume", "service_name": "Block St ... (513 characters truncated) ... b": 5, "created_at": "2025-10-24T13:00:00", "project_id": "ae452e6f559f4aeca2c4412dcbbfb60b", "project_name": "second project"}, "external_ip": null}', 'changes_detected': '{"effective_cost": {"previous": 3.12, "current": 0.0}}', 'service_name': 'Block Storage', 'region': 'ru-8', 'status': 'RUNNING', 'effective_cost': 0.0, 'has_cost_change': 1, 'has_status_change': 0, 'has_config_change': 0, 'created_at': datetime.datetime(2025, 10, 25, 13, 40, 39, 375603), 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 39, 375606)}
2025-10-25 13:40:39,377 INFO sqlalchemy.engine.Engine: COMMIT
2025-10-25 13:40:39,379 INFO sqlalchemy.engine.Engine: BEGIN (implicit)
2025-10-25 13:40:39,380 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.billing_period AS resources_billing_period, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:39,380 INFO sqlalchemy.engine.Engine: [cached since 11.98s ago] {'pk_1': 5}
2025-10-25 13:40:39,381 INFO sqlalchemy.engine.Engine: UPDATE resources SET status=%(status)s, effective_cost=%(effective_cost)s, currency=%(currency)s, daily_cost=%(daily_cost)s, original_cost=%(original_cost)s, updated_at=%(updated_at)s WHERE resources.id = %(resources_id)s
2025-10-25 13:40:39,382 INFO sqlalchemy.engine.Engine: [cached since 11.98s ago] {'status': 'RUNNING', 'effective_cost': 3.12, 'currency': 'RUB', 'daily_cost': 3.12, 'original_cost': 93.6, 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 39, 381962), 'resources_id': 5}
2025-10-25 13:40:39,383 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.billing_period AS resources_billing_period, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:39,383 INFO sqlalchemy.engine.Engine: [cached since 11.98s ago] {'pk_1': 5}
2025-10-25 13:40:39,384 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:39,384 INFO sqlalchemy.engine.Engine: [cached since 29.99s ago] {'resource_id_1': 5, 'tag_key_1': 'cost_source', 'param_1': 1}
2025-10-25 13:40:39,386 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:39,386 INFO sqlalchemy.engine.Engine: [cached since 29.99s ago] {'resource_id_1': 5, 'tag_key_1': 'note', 'param_1': 1}
2025-10-25 13:40:39,387 INFO app.providers.selectel.service: Processed volumes: 0 orphans, 2 total
2025-10-25 13:40:39,387 INFO app.providers.selectel.service: PHASE 5: Processing file storage
2025-10-25 13:40:39,387 INFO app.providers.selectel.service: PHASE 6: Processing other services (K8s, DBaaS, S3, etc.)
2025-10-25 13:40:39,387 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_status AS sync_snapshots_sync_status, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_completed_at AS sync_snapshots_sync_completed_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.total_resources_found AS sync_snapshots_total_resources_found, sync_snapshots.resources_created AS sync_snapshots_resources_created, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.id = %(pk_1)s
2025-10-25 13:40:39,388 INFO sqlalchemy.engine.Engine: [cached since 33.51s ago] {'pk_1': 5354}
2025-10-25 13:40:39,389 INFO sqlalchemy.engine.Engine: SELECT cloud_providers.user_id AS cloud_providers_user_id, cloud_providers.provider_type AS cloud_providers_provider_type, cloud_providers.connection_name AS cloud_providers_connection_name, cloud_providers.account_id AS cloud_providers_account_id, cloud_providers.api_endpoint AS cloud_providers_api_endpoint, cloud_providers.credentials AS cloud_providers_credentials, cloud_providers.is_active AS cloud_providers_is_active, cloud_providers.last_sync AS cloud_providers_last_sync, cloud_providers.sync_status AS cloud_providers_sync_status, cloud_providers.sync_error AS cloud_providers_sync_error, cloud_providers.auto_sync AS cloud_providers_auto_sync, cloud_providers.sync_interval AS cloud_providers_sync_interval, cloud_providers.provider_metadata AS cloud_providers_provider_metadata, cloud_providers.id AS cloud_providers_id, cloud_providers.created_at AS cloud_providers_created_at, cloud_providers.updated_at AS cloud_providers_updated_at 
FROM cloud_providers 
WHERE cloud_providers.id = %(pk_1)s
2025-10-25 13:40:39,389 INFO sqlalchemy.engine.Engine: [cached since 30.02s ago] {'pk_1': 2}
2025-10-25 13:40:39,390 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.provider_id = %(provider_id_1)s AND resources.resource_id = %(resource_id_1)s
2025-10-25 13:40:39,391 INFO sqlalchemy.engine.Engine: [cached since 30.02s ago] {'provider_id_1': 2, 'resource_id_1': '864e528c-7dbe-4723-b414-ca32f50e7876'}
2025-10-25 13:40:39,393 INFO sqlalchemy.engine.Engine: UPDATE resources SET last_sync=%(last_sync)s, updated_at=%(updated_at)s WHERE resources.id = %(resources_id)s
2025-10-25 13:40:39,393 INFO sqlalchemy.engine.Engine: [cached since 30.01s ago] {'last_sync': datetime.datetime(2025, 10, 25, 13, 40, 39, 392440), 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 39, 393176), 'resources_id': 7}
2025-10-25 13:40:39,394 INFO sqlalchemy.engine.Engine: INSERT INTO resource_states (sync_snapshot_id, resource_id, provider_resource_id, resource_type, resource_name, state_action, previous_state, current_state, changes_detected, service_name, region, status, effective_cost, has_cost_change, has_status_change, has_config_change, created_at, updated_at) VALUES (%(sync_snapshot_id)s, %(resource_id)s, %(provider_resource_id)s, %(resource_type)s, %(resource_name)s, %(state_action)s, %(previous_state)s, %(current_state)s, %(changes_detected)s, %(service_name)s, %(region)s, %(status)s, %(effective_cost)s, %(has_cost_change)s, %(has_status_change)s, %(has_config_change)s, %(created_at)s, %(updated_at)s)
2025-10-25 13:40:39,394 INFO sqlalchemy.engine.Engine: [cached since 30.01s ago] {'sync_snapshot_id': 5354, 'resource_id': 7, 'provider_resource_id': '864e528c-7dbe-4723-b414-ca32f50e7876', 'resource_type': 'load_balancer', 'resource_name': 'Renae-lb', 'state_action': 'updated', 'previous_state': '{"id": 7, "provider_id": 2, "resource_id": "864e528c-7dbe-4723-b414-ca32f50e7876", "resource_name": "Renae-lb", "region": "unknown", "external_ip": n ... (819 characters truncated) ... ": {"load_balancers_single_2_1024": 512}, "service_type": "load_balancer"}, "created_at": "2025-10-14T07:35:57", "updated_at": "2025-10-25T13:39:28"}', 'current_state': '{"resource_id": "864e528c-7dbe-4723-b414-ca32f50e7876", "resource_name": "Renae-lb", "resource_type": "load_balancer", "service_name": "Load Balancer ... (470 characters truncated) ... les": 41.04, "monthly_cost_rubles": 1231.2}, "metrics": {"load_balancers_single_2_1024": 512}, "service_type": "load_balancer"}, "external_ip": null}', 'changes_detected': '{"effective_cost": {"previous": 41.04, "current": 0.0}}', 'service_name': 'Load Balancer', 'region': 'unknown', 'status': 'RUNNING', 'effective_cost': 0.0, 'has_cost_change': 1, 'has_status_change': 0, 'has_config_change': 0, 'created_at': datetime.datetime(2025, 10, 25, 13, 40, 39, 394374), 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 39, 394377)}
2025-10-25 13:40:39,396 INFO sqlalchemy.engine.Engine: COMMIT
2025-10-25 13:40:39,398 INFO sqlalchemy.engine.Engine: BEGIN (implicit)
2025-10-25 13:40:39,398 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.billing_period AS resources_billing_period, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:39,399 INFO sqlalchemy.engine.Engine: [cached since 30.01s ago] {'pk_1': 7}
2025-10-25 13:40:39,400 INFO sqlalchemy.engine.Engine: UPDATE resources SET effective_cost=%(effective_cost)s, currency=%(currency)s, daily_cost=%(daily_cost)s, original_cost=%(original_cost)s, updated_at=%(updated_at)s WHERE resources.id = %(resources_id)s
2025-10-25 13:40:39,400 INFO sqlalchemy.engine.Engine: [cached since 30.01s ago] {'effective_cost': 41.04, 'currency': 'RUB', 'daily_cost': 41.04, 'original_cost': 1231.2, 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 39, 400131), 'resources_id': 7}
2025-10-25 13:40:39,400 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.billing_period AS resources_billing_period, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:39,401 INFO sqlalchemy.engine.Engine: [cached since 30.01s ago] {'pk_1': 7}
2025-10-25 13:40:39,402 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:39,402 INFO sqlalchemy.engine.Engine: [cached since 30.01s ago] {'resource_id_1': 7, 'tag_key_1': 'cost_source', 'param_1': 1}
2025-10-25 13:40:39,403 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:39,403 INFO sqlalchemy.engine.Engine: [cached since 30.01s ago] {'resource_id_1': 7, 'tag_key_1': 'service_type', 'param_1': 1}
2025-10-25 13:40:39,404 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:39,404 INFO sqlalchemy.engine.Engine: [cached since 30.01s ago] {'resource_id_1': 7, 'tag_key_1': 'metric_load_balancers_single_2_1024', 'param_1': 1}
2025-10-25 13:40:39,406 INFO sqlalchemy.engine.Engine: SELECT cloud_providers.user_id AS cloud_providers_user_id, cloud_providers.provider_type AS cloud_providers_provider_type, cloud_providers.connection_name AS cloud_providers_connection_name, cloud_providers.account_id AS cloud_providers_account_id, cloud_providers.api_endpoint AS cloud_providers_api_endpoint, cloud_providers.credentials AS cloud_providers_credentials, cloud_providers.is_active AS cloud_providers_is_active, cloud_providers.last_sync AS cloud_providers_last_sync, cloud_providers.sync_status AS cloud_providers_sync_status, cloud_providers.sync_error AS cloud_providers_sync_error, cloud_providers.auto_sync AS cloud_providers_auto_sync, cloud_providers.sync_interval AS cloud_providers_sync_interval, cloud_providers.provider_metadata AS cloud_providers_provider_metadata, cloud_providers.id AS cloud_providers_id, cloud_providers.created_at AS cloud_providers_created_at, cloud_providers.updated_at AS cloud_providers_updated_at 
FROM cloud_providers 
WHERE cloud_providers.id = %(pk_1)s
2025-10-25 13:40:39,406 INFO sqlalchemy.engine.Engine: [cached since 30.04s ago] {'pk_1': 2}
2025-10-25 13:40:39,407 INFO app.providers.selectel.service: PHASE 7: Performance statistics ENABLED
2025-10-25 13:40:39,409 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:39,409 INFO sqlalchemy.engine.Engine: [generated in 0.00017s] {'pk_1': 1286}
2025-10-25 13:40:39,410 INFO app.providers.selectel.client: Collecting statistics for Tess (ID: 0264e6f6-b624-4f6f-a...) in region ru-3, project 48643015916742d080f0...
2025-10-25 13:40:42,141 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.provider_id = %(provider_id_1)s AND resources.resource_id = %(resource_id_1)s AND resources.resource_type = %(resource_type_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:42,141 INFO sqlalchemy.engine.Engine: [generated in 0.00037s] {'provider_id_1': 2, 'resource_id_1': '0264e6f6-b624-4f6f-a605-7db0ca0553d9', 'resource_type_1': 'server', 'param_1': 1}
2025-10-25 13:40:42,144 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:42,144 INFO sqlalchemy.engine.Engine: [cached since 32.75s ago] {'resource_id_1': 1286, 'tag_key_1': 'cpu_avg_usage', 'param_1': 1}
2025-10-25 13:40:42,145 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:42,145 INFO sqlalchemy.engine.Engine: [cached since 32.75s ago] {'resource_id_1': 1286, 'tag_key_1': 'cpu_max_usage', 'param_1': 1}
2025-10-25 13:40:42,147 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:42,147 INFO sqlalchemy.engine.Engine: [cached since 32.75s ago] {'resource_id_1': 1286, 'tag_key_1': 'cpu_min_usage', 'param_1': 1}
2025-10-25 13:40:42,148 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:42,148 INFO sqlalchemy.engine.Engine: [cached since 32.75s ago] {'resource_id_1': 1286, 'tag_key_1': 'cpu_trend', 'param_1': 1}
2025-10-25 13:40:42,149 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:42,149 INFO sqlalchemy.engine.Engine: [cached since 32.75s ago] {'resource_id_1': 1286, 'tag_key_1': 'cpu_performance_tier', 'param_1': 1}
2025-10-25 13:40:42,150 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:42,150 INFO sqlalchemy.engine.Engine: [cached since 32.76s ago] {'resource_id_1': 1286, 'tag_key_1': 'cpu_data_points', 'param_1': 1}
2025-10-25 13:40:42,151 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:42,151 INFO sqlalchemy.engine.Engine: [cached since 32.76s ago] {'resource_id_1': 1286, 'tag_key_1': 'cpu_period', 'param_1': 1}
2025-10-25 13:40:42,152 INFO sqlalchemy.engine.Engine: SELECT resource_tags.resource_id AS resource_tags_resource_id, resource_tags.tag_key AS resource_tags_tag_key, resource_tags.tag_value AS resource_tags_tag_value, resource_tags.id AS resource_tags_id, resource_tags.created_at AS resource_tags_created_at, resource_tags.updated_at AS resource_tags_updated_at 
FROM resource_tags 
WHERE resource_tags.resource_id = %(resource_id_1)s AND resource_tags.tag_key = %(tag_key_1)s 
 LIMIT %(param_1)s
2025-10-25 13:40:42,152 INFO sqlalchemy.engine.Engine: [cached since 32.76s ago] {'resource_id_1': 1286, 'tag_key_1': 'cpu_collection_timestamp', 'param_1': 1}
2025-10-25 13:40:42,153 ERROR app.providers.selectel.service: Error processing statistics for server 0264e6f6-b624-4f6f-a605-7db0ca0553d9: local variable 'json' referenced before assignment
2025-10-25 13:40:42,153 INFO app.providers.selectel.service: Retrieved statistics for 1 servers
2025-10-25 13:40:42,153 INFO app.providers.selectel.service: PHASE 8: Finalizing sync
2025-10-25 13:40:42,154 INFO sqlalchemy.engine.Engine: UPDATE resource_tags SET tag_value=%(tag_value)s, updated_at=%(updated_at)s WHERE resource_tags.id = %(resource_tags_id)s
2025-10-25 13:40:42,154 INFO sqlalchemy.engine.Engine: [generated in 0.00017s] {'tag_value': '2025-10-25T10:40:41.104712', 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 42, 154070), 'resource_tags_id': 2715}
2025-10-25 13:40:42,156 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:42,156 INFO sqlalchemy.engine.Engine: [cached since 2.747s ago] {'pk_1': 6}
2025-10-25 13:40:42,157 INFO sqlalchemy.engine.Engine: SELECT resources.provider_id AS resources_provider_id, resources.resource_id AS resources_resource_id, resources.resource_name AS resources_resource_name, resources.region AS resources_region, resources.external_ip AS resources_external_ip, resources.service_name AS resources_service_name, resources.resource_type AS resources_resource_type, resources.status AS resources_status, resources.pricing_model AS resources_pricing_model, resources.list_price AS resources_list_price, resources.effective_cost AS resources_effective_cost, resources.currency AS resources_currency, resources.billing_period AS resources_billing_period, resources.daily_cost AS resources_daily_cost, resources.original_cost AS resources_original_cost, resources.cost_period AS resources_cost_period, resources.cost_frequency AS resources_cost_frequency, resources.business_unit AS resources_business_unit, resources.project_id AS resources_project_id, resources.feature_tag AS resources_feature_tag, resources.cost_center AS resources_cost_center, resources.environment AS resources_environment, resources.last_sync AS resources_last_sync, resources.is_active AS resources_is_active, resources.provider_config AS resources_provider_config, resources.id AS resources_id, resources.created_at AS resources_created_at, resources.updated_at AS resources_updated_at 
FROM resources 
WHERE resources.id = %(pk_1)s
2025-10-25 13:40:42,157 INFO sqlalchemy.engine.Engine: [cached since 2.748s ago] {'pk_1': 5}
2025-10-25 13:40:42,159 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.id = %(pk_1)s
2025-10-25 13:40:42,159 INFO sqlalchemy.engine.Engine: [generated in 0.00012s] {'pk_1': 5354}
2025-10-25 13:40:42,160 INFO sqlalchemy.engine.Engine: UPDATE sync_snapshots SET sync_status=%(sync_status)s, sync_completed_at=%(sync_completed_at)s, total_resources_found=%(total_resources_found)s, resources_created=%(resources_created)s, updated_at=%(updated_at)s WHERE sync_snapshots.id = %(sync_snapshots_id)s
2025-10-25 13:40:42,160 INFO sqlalchemy.engine.Engine: [generated in 0.00013s] {'sync_status': 'success', 'sync_completed_at': datetime.datetime(2025, 10, 25, 13, 40, 42, 158035), 'total_resources_found': 4, 'resources_created': 4, 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 42, 160298), 'sync_snapshots_id': 5354}
2025-10-25 13:40:42,161 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.id = %(pk_1)s
2025-10-25 13:40:42,161 INFO sqlalchemy.engine.Engine: [cached since 0.002137s ago] {'pk_1': 5354}
2025-10-25 13:40:42,162 INFO sqlalchemy.engine.Engine: UPDATE cloud_providers SET last_sync=%(last_sync)s, updated_at=%(updated_at)s WHERE cloud_providers.id = %(cloud_providers_id)s
2025-10-25 13:40:42,162 INFO sqlalchemy.engine.Engine: [generated in 0.00012s] {'last_sync': datetime.datetime(2025, 10, 25, 13, 40, 42, 161944), 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 42, 162566), 'cloud_providers_id': 2}
2025-10-25 13:40:42,163 INFO sqlalchemy.engine.Engine: UPDATE sync_snapshots SET sync_duration_seconds=%(sync_duration_seconds)s, sync_config=%(sync_config)s, updated_at=%(updated_at)s WHERE sync_snapshots.id = %(sync_snapshots_id)s
2025-10-25 13:40:42,163 INFO sqlalchemy.engine.Engine: [generated in 0.00011s] {'sync_duration_seconds': 42, 'sync_config': '{"sync_method": "billing_first", "openstack_auth_ok": true, "orphan_volumes": 0, "zombie_resources": 0, "unified_vms": 1, "total_daily_cost": 57.6, "zombie_daily_cost": 0, "orphan_daily_cost": 0, "service_types": ["load_balancer", "server", "volume"], "billed_resource_count": 4}', 'updated_at': datetime.datetime(2025, 10, 25, 13, 40, 42, 163515), 'sync_snapshots_id': 5354}
2025-10-25 13:40:42,164 INFO sqlalchemy.engine.Engine: COMMIT
2025-10-25 13:40:42,165 INFO app.providers.selectel.service: Sync completed: 4 resources, 57.60 ₽/day
2025-10-25 13:40:42,165 INFO app.providers.selectel.service:   - Active: 4
2025-10-25 13:40:42,165 INFO app.providers.selectel.service:   - Zombies: 0 (0.00 ₽/day)
2025-10-25 13:40:42,165 INFO app.providers.selectel.service:   - Orphan volumes: 0 (0.00 ₽/day)
2025-10-25 13:40:42,166 INFO sqlalchemy.engine.Engine: BEGIN (implicit)
2025-10-25 13:40:42,166 INFO sqlalchemy.engine.Engine: SELECT sync_snapshots.provider_id AS sync_snapshots_provider_id, sync_snapshots.sync_type AS sync_snapshots_sync_type, sync_snapshots.sync_status AS sync_snapshots_sync_status, sync_snapshots.sync_started_at AS sync_snapshots_sync_started_at, sync_snapshots.sync_completed_at AS sync_snapshots_sync_completed_at, sync_snapshots.sync_duration_seconds AS sync_snapshots_sync_duration_seconds, sync_snapshots.total_resources_found AS sync_snapshots_total_resources_found, sync_snapshots.resources_created AS sync_snapshots_resources_created, sync_snapshots.resources_updated AS sync_snapshots_resources_updated, sync_snapshots.resources_deleted AS sync_snapshots_resources_deleted, sync_snapshots.resources_unchanged AS sync_snapshots_resources_unchanged, sync_snapshots.total_monthly_cost AS sync_snapshots_total_monthly_cost, sync_snapshots.total_resources_by_type AS sync_snapshots_total_resources_by_type, sync_snapshots.total_resources_by_status AS sync_snapshots_total_resources_by_status, sync_snapshots.error_message AS sync_snapshots_error_message, sync_snapshots.error_details AS sync_snapshots_error_details, sync_snapshots.sync_config AS sync_snapshots_sync_config, sync_snapshots.id AS sync_snapshots_id, sync_snapshots.created_at AS sync_snapshots_created_at, sync_snapshots.updated_at AS sync_snapshots_updated_at 
FROM sync_snapshots 
WHERE sync_snapshots.id = %(pk_1)s
2025-10-25 13:40:42,166 INFO sqlalchemy.engine.Engine: [cached since 36.28s ago] {'pk_1': 5354}
2025-10-25 13:40:42,167 INFO sqlalchemy.engine.Engine: ROLLBACK
